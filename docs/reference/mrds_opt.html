<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tips on optimisation issues in mrds models — mrds_opt • mrds</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tips on optimisation issues in mrds models — mrds_opt"><meta name="description" content='Occasionally when fitting an `mrds` model one can run into optimisation
issues. In general such problems can be quite complex so these "quick fixes"
may not work. If you come up against problems that are not fixed by these
tips, or you feel the results are dubious please go ahead and contact the
package authors.'><meta property="og:description" content='Occasionally when fitting an `mrds` model one can run into optimisation
issues. In general such problems can be quite complex so these "quick fixes"
may not work. If you come up against problems that are not fixed by these
tips, or you feel the results are dubious please go ahead and contact the
package authors.'><script type="text/javascript">(function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script", "m9r3j2v7dj");</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mrds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0.9005</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Function reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mrds-golftees.html">Point and full independence</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/mrds/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tips on optimisation issues in <code>mrds</code> models</h1>
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/mrds/blob/HEAD/R/mrds-package.R" class="external-link"><code>R/mrds-package.R</code></a></small>
      <div class="d-none name"><code>mrds_opt.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Occasionally when fitting an `mrds` model one can run into optimisation
issues. In general such problems can be quite complex so these "quick fixes"
may not work. If you come up against problems that are not fixed by these
tips, or you feel the results are dubious please go ahead and contact the
package authors.</p>
    </div>


    <div class="section level2">
    <h2 id="debug-mode">Debug mode<a class="anchor" aria-label="anchor" href="#debug-mode"></a></h2>


<p>One can obtain debug output at each stage of the optimisation using the
<code>showit</code> option. This is set via <code>control</code>, so adding
<code>control=list(showit=3)</code> gives the highest level of debug output
(setting <code>showit</code> to 1 or 2 gives less output).</p>
    </div>
    <div class="section level2">
    <h2 id="re-scaling-covariates">Re-scaling covariates<a class="anchor" aria-label="anchor" href="#re-scaling-covariates"></a></h2>


<p>Sometimes convergence issues in covariate (MCDS) models are caused by values
of the covariate being very large, so a rescaling of that covariate is then
necessary. Simply scaling by the standard deviation of the covariate can
help (e.g. <code>dat$size.scaled &lt;- dat$scale/sd(dat$scale)</code> for a covariate
<code>size</code>, then including <code>size.scaled</code> in the model instead of
<code>size</code>).</p>
<p>It is important to note that one needs to use the original covariate (size)
when computing Horvitz-Thompson estimates of population size if the group
size is used in that estimate. i.e. use the unscaled size in the numerator
of the H-T estimator.</p>
    </div>
    <div class="section level2">
    <h2 id="factor-levels">Factor levels<a class="anchor" aria-label="anchor" href="#factor-levels"></a></h2>


<p>By default R will set the base factor level to be the label which comes
first alphabetically. Sometimes this can be an issue when that factor level
corresponds to a subset of the data with very few observations. This can
lead to very large uncertainty estimates (CVs) for model parameters. One way
around this is to use <code><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></code> to set the base level to a level
with more observations.</p>
    </div>
    <div class="section level2">
    <h2 id="initial-values">Initial values<a class="anchor" aria-label="anchor" href="#initial-values"></a></h2>


<p>Initial (or starting) values for the dsmodel can be set via the <code>initial</code>
element of the <code>control</code> list. <code>initial</code> is a list itself with
elements <code>scale</code>, <code>shape</code> and <code>adjustment</code>, corresponding to
the associated parameters. If a model has covariates then the <code>scale</code> or
<code>shape</code> elements will be vectors with parameter initial values in the
same order as they are specific in the model formula (using <code>showit</code> is
a good check they are in the correct order). Adjustment starting values are
in order of the order of that term (cosine order 2 is before cosine order 3
terms).</p>
<p>One way of obtaining starting values is to fit a simpler model first (say
with fewer covariates or adjustments) and then use the starting values from
this simpler model for the corresponding parameters.</p>
<p>Another alternative to obtain starting values is to fit the model (or some
submodel) using Distance for Windows. Note that Distance reports the scale
parameter (or intercept in a covariate model) on the exponential scale, so
one must <code>log</code> this before supplying it to <code>ddf</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="bounds">Bounds<a class="anchor" aria-label="anchor" href="#bounds"></a></h2>


<p>One can change the upper and lower bounds for the dsmodel parameters. These
specify the largest and smallest values individual parameters can be. By
placing these constraints on the parameters, it is possible to "temper" the
optimisation problem, making fitting possible.</p>
<p>Again, one uses the <code>control</code> list, the elements <code>upperbounds</code> and
<code>lowerbounds</code>. In this case, each of <code>upperbounds</code> and
<code>lowerbounds</code> are vectors, which one can think of as each of the
vectors <code>shape</code>, <code>scale</code> and <code>adjustment</code> from the "Initial
values" section above, concatenated in that order. If one does not occur
(e.g. no shape parameter) then it is simple omitted from the vector.</p>
    </div>
    <div class="section level2">
    <h2 id="conventional-distance-sampling-optimizer-choice">Conventional distance sampling optimizer choice<a class="anchor" aria-label="anchor" href="#conventional-distance-sampling-optimizer-choice"></a></h2>


<p>The key function plus adjustment approach of Conventional Distance Sampling (CDS)
can sometimes run into issues because it is sensible to constrain the fitted
detection function to be monotonic non-increasing (i.e., flat or going down)
with increasing distance - finding the maximum of the constrained likelihood
is more difficult than the same task without constraints.</p>
<p>There are several options within the `ddf` <code>control</code> argument that may help
if difficulties are encountered.  These are documented in the <code><a href="ddf.html">ddf</a></code>
manual page, and a few are mentioned below.</p>
<p>One potential strategy (as mentioned above) is to use better starting values for the
optimization.  If <code>mono.startvals</code> is set to <code>TRUE</code>
then the detection function is first fit without adjustments and the resulting
scale (and shape) estimates used as starting values in the model with adjustments.
For even finer control, the <code>initial</code> option can be used as documented above.</p>
<p>Another potential thing to change is the constraint solver used.  From `mrds` v 3.0.0
a new constraint solver, `slsqp`, has been included as the default.  This was found
to work better than the solver previously used (`solnp`) but if needed this solver
can be specified using the <code>mono.method</code> option of the <code>control</code> argument of
`ddf`.</p>
<p>It is also possible to use the optimizer implemented in Distance for Windows by downloading
a separate binary - see the manual page on <code><a href="mcds_dot_exe.html">mcds_dot_exe</a></code>.  If specified, this
will also be used for Multiple Covariate Distance Sampling (MCDS) analyses.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David L. Miller &lt;dave@ninepointeightone.net&gt;</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer></div>





  </body></html>

